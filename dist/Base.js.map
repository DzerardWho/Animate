{"version":3,"file":"Base.js","sources":["../src/Programs.ts","../src/Container.ts","../src/Instance.ts","../src/Renderable.ts","../src/Color.ts","../src/Rectangle.ts","../src/Sprite.ts","../src/Base.ts"],"sourcesContent":["export const dvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\n\r\nuniform mat3 mWorld;\r\nuniform mat3 mProj;\r\n\r\nvoid main(){\r\n    gl_Position = vec4((mProj * mWorld * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dfs = `precision mediump float;\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    gl_FragColor = uColor;\r\n}`;\r\n\r\nexport const dsvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\nattribute vec2 aTextureCoords;\r\n\r\nuniform mat3 mWorld;\r\nuniform mat3 mProj;\r\n\r\nvarying vec2 f_texCoord;\r\n\r\nvoid main(){\r\n\tf_texCoord = aTextureCoords;\r\n    gl_Position = vec4((mProj * mWorld * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dsfs = `precision mediump float;\r\n\r\nvarying vec2 f_texCoord;\r\nuniform sampler2D sampler;\r\n\r\nvoid main(){\r\n\tgl_FragColor = texture2D(sampler, f_texCoord);\r\n}`;\r\n","// import * as glMatrix from \"gl-matrix\";\r\nimport { vec2 } from './Base'\r\nimport { Instance, instance } from './Instance'\r\nimport { Rectangle } from './Rectangle'\r\nimport { Sprite } from './Sprite'\r\nimport { _Color } from './Color'\r\nimport { Base } from './Base'\r\n\r\nexport class Container {\r\n\tchildren: Array<Container | Rectangle> = [];\r\n\tlocalMatrix: Float32Array;\r\n\tworldMatrix: Float32Array;\r\n\tgl: WebGLRenderingContext;\r\n\tbase: Base;\r\n\tparent: Container | Rectangle | Sprite;\r\n\tinstances: Array<Instance>;\r\n\r\n\tx: number;\r\n\ty: number;\r\n\tog_width: number;\r\n\tog_height: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tprivate _angle: number;\r\n\tscale: vec2;\r\n\ttransformationPoint: vec2;\r\n\tprogram: null = null;\r\n\tcolor: null = null;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\tw: number,\r\n\t\th: number,\r\n\t\ttransformationPoint: vec2 = { x: 0, y: 0 }\r\n\t) {\r\n\t\tthis.localMatrix = glMatrix.mat3.identity(new Float32Array(9));\r\n\t\tthis.worldMatrix = glMatrix.mat3.identity(new Float32Array(9));\r\n\t\tthis.base = base;\r\n\t\tthis.gl = base.gl;\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.og_width = w;\r\n\t\tthis.og_height = h;\r\n\t\tthis.width = this.og_width;\r\n\t\tthis.height = this.og_height;\r\n\t\tthis.angle = 0;\r\n\t\tthis.scale = { x: 1, y: 1 };\r\n\t\tthis.instances = [];\r\n\t\tthis.transformationPoint = { x: transformationPoint[\"x\"], y: transformationPoint[\"y\"] };\r\n\r\n\t\tthis.base.symbols.push(this);\r\n\t}\r\n\r\n\taddChild(child, createInstance: boolean = false){\r\n\t\tif (!child){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (child.parent){\r\n\t\t\tlet ndx = child.parent.children.indexOf(child.source);\r\n\t\t\tif (ndx >= 0){\r\n\t\t\t\tchild.parent.children.splice(ndx, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tchild.parent = this;\r\n\t\tthis.children.push(child);\r\n\t\tif (createInstance){\r\n\t\t\tthis.instances.forEach(instance => {\r\n\t\t\t\tinstance.addChild(child);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tsetParent(parent) {\r\n\t\tif (this.parent) {\r\n\t\t\tlet ndx = this.parent.children.indexOf(this);\r\n\t\t\tif (ndx >= 0) {\r\n\t\t\t\tthis.parent.children.splice(ndx, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (parent) {\r\n\t\t\tparent.children.push(this);\r\n\t\t}\r\n\t\tthis.parent = parent;\r\n\t}\r\n\r\n\tupdateWorldMatrix() {\r\n\t\tthis.instances.forEach(instance => {\r\n\t\t\tinstance.updateWorldMatrix();\r\n\t\t});\r\n\t}\r\n\r\n\tmoveTo(x: number, y: number) {\r\n\t\tglMatrix.mat3.translate(this.worldMatrix, this.worldMatrix, [x, y]);\r\n\t}\r\n\r\n\tscaleAndRotate() {\r\n\t\tthis.moveTo(this.transformationPoint[\"x\"], this.transformationPoint[\"y\"]);\r\n\t\tglMatrix.mat3.scale(this.worldMatrix, this.worldMatrix, [\r\n\t\t\tthis.scale.x,\r\n\t\t\tthis.scale.y\r\n\t\t]);\r\n\t\tglMatrix.mat3.rotate(this.worldMatrix, this.worldMatrix, this.angle);\r\n\t\tthis.moveTo(-this.transformationPoint[\"x\"], -this.transformationPoint[\"y\"]);\r\n\t}\r\n\r\n\tget angle() {\r\n\t\treturn this._angle;\r\n\t}\r\n\r\n\tset angle(a) {\r\n\t\tthis._angle = glMatrix.glMatrix.toRadian(a);\r\n\t}\r\n}\r\n","// import * as glMatrix from \"gl-matrix\";\r\nimport { vec2 } from './Base'\r\nimport { Container } from './Container'\r\nimport { Renderable } from './Renderable'\r\nimport { Rectangle } from './Rectangle'\r\nimport { Sprite } from './Sprite'\r\nimport { _Color } from './Color'\r\n\r\n\r\nexport interface instance {\r\n\tvisible: boolean;\r\n\tx: number;\r\n\ty: number;\r\n\tangle: number;\r\n\tscale: vec2;\r\n\ttransformationPoint: vec2;\r\n\tsource: Container | Renderable | Rectangle | Sprite;\r\n\tchildren: Array<instance>;\r\n\t// localMatrix: Float32Array;\r\n\tworldMatrix: Float32Array;\r\n\tbuffer: WebGLFramebuffer | null;\r\n}\r\n\r\nexport class Instance implements instance {\r\n\tvisible: boolean;\r\n\tx: number;\r\n\ty: number;\r\n\tangle: number;\r\n\tscale: vec2;\r\n\ttransformationPoint: vec2;\r\n\tsource: Container | Renderable | Rectangle | Sprite;\r\n\tchildren: Array<Instance>;\r\n\tlocalMatrix: Float32Array;\r\n\tworldMatrix: Float32Array;\r\n\tbuffer: WebGLFramebuffer | null;\r\n\tisChild: any;\r\n\r\n\tconstructor(source: Container | Rectangle | Sprite, isChild: boolean = false) {\r\n\t\tthis.source = source;\r\n\t\tthis.visible = true;\r\n\t\tthis.x = source.x;\r\n\t\tthis.y = source.y;\r\n\t\tthis.angle = source.angle;\r\n\t\tthis.scale = source.scale;\r\n\t\tthis.transformationPoint = source.transformationPoint;\r\n\t\tthis.children = [];\r\n\t\t// this.localMatrix = new Float32Array(9);\r\n\t\tthis.worldMatrix = new Float32Array(9);\r\n\t\tthis.buffer = source.gl.createFramebuffer();\r\n\t\tthis.isChild = isChild;\r\n\r\n\t\tthis.source.base.renderQueue.push(this);\r\n\t\tsource.children.forEach(child => {\r\n\t\t\tthis.children.push(new Instance(child, true));\r\n\t\t});\r\n\r\n\t\tsource.instances.push(this);\r\n\t}\r\n\r\n\tupdateWorldMatrix(parentWorldMatrix?: Float32Array) {\r\n\t\tglMatrix.mat3.fromTranslation(this.worldMatrix, [this.x, this.y]);\r\n\t\tthis.scaleAndRotate();\r\n\t\tif (parentWorldMatrix) {\r\n\t\t\tglMatrix.mat3.multiply(\r\n\t\t\t\tthis.worldMatrix,\r\n\t\t\t\tparentWorldMatrix,\r\n\t\t\t\tthis.worldMatrix\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet worldMatrix = this.worldMatrix;\r\n\t\tthis.children.forEach(child => {\r\n\t\t\tchild.updateWorldMatrix(worldMatrix);\r\n\t\t});\r\n\t\t// glMatrix.mat3.identity(this.localMatrix);\r\n\t}\r\n\r\n\tmoveTo(x: number, y: number) {\r\n\t\tglMatrix.mat3.translate(this.worldMatrix, this.worldMatrix, [x, y]);\r\n\t}\r\n\r\n\tscaleAndRotate() {\r\n\t\tthis.moveTo(this.transformationPoint[\"x\"], this.transformationPoint[\"y\"]);\r\n\t\tglMatrix.mat3.scale(this.worldMatrix, this.worldMatrix, [\r\n\t\t\tthis.scale.x,\r\n\t\t\tthis.scale.y\r\n\t\t]);\r\n\t\tglMatrix.mat3.rotate(this.worldMatrix, this.worldMatrix, this.angle);\r\n\t\tthis.moveTo(-this.transformationPoint[\"x\"], -this.transformationPoint[\"y\"]);\r\n\t}\r\n\r\n\taddChild(child: any){\r\n\t\tthis.children.push(new Instance(child, true));\r\n\t}\r\n}","import { Container } from './Container'\r\nimport { vec2, Base } from './Base'\r\n\r\nexport class Renderable extends Container {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\tshapeBuffer: WebGLBuffer;\r\n\tindicesBuffer: WebGLBuffer;\r\n\tprogram: WebGLProgram;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tx?: number,\r\n\t\ty?: number,\r\n\t\tw?: number,\r\n\t\th?: number,\r\n\t\ttransformationPoint: vec2 = { x: 0, y: 0 }\r\n\t) {\r\n\t\tsuper(base, x, y, w, h, transformationPoint);\r\n\r\n\t\tthis.shapeBuffer = this.gl.createBuffer();\r\n\t\tthis.indicesBuffer = base.defaultIndicesBuffer;\r\n\t\tthis.attribs = {};\r\n\t\tthis.uniforms = {};\r\n\t\tthis.base.objectsToDraw.push(this);\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\tthis.height,\r\n\t\t\t\tthis.width,\r\n\t\t\t\t0,\r\n\t\t\t\tthis.width,\r\n\t\t\t\tthis.height\r\n\t\t\t]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\t}\r\n}\r\n","export interface _Color {\r\n\t[0]: number;\r\n\t[1]: number;\r\n\t[2]: number;\r\n\t[3]?: number;\r\n}\r\n\r\nexport class Color {\r\n\tprivate _r: number;\r\n\tprivate _g: number;\r\n\tprivate _b: number;\r\n\tprivate _a: number;\r\n\tprivate _buffer: Float32Array;\r\n\r\n\tconstructor(r?: number | _Color, g?: number, b?: number, a?: number) {\r\n\t\tif (typeof r == \"object\") {\r\n\t\t\tthis._r = r[0] ? this.abs_val(r[0]) : 1;\r\n\t\t\tthis._g = r[1] ? this.abs_val(r[1]) : 1;\r\n\t\t\tthis._b = r[2] ? this.abs_val(r[2]) : 1;\r\n\t\t\tthis._a = r[3] ? this.abs_val(r[3]) : 1;\r\n\t\t} else {\r\n\t\t\tthis._r = r ? this.abs_val(r) : 1;\r\n\t\t\tthis._g = g ? this.abs_val(g) : 1;\r\n\t\t\tthis._b = b ? this.abs_val(b) : 1;\r\n\t\t\tthis._a = a ? this.abs_val(a) : 1;\r\n\t\t}\r\n\t\tthis._buffer = new Float32Array(this.getColor());\r\n\t}\r\n\r\n\tset r(_c: number) {\r\n\t\tthis._r = this.abs_val(_c);\r\n\t}\r\n\r\n\tget r() {\r\n\t\treturn this._r;\r\n\t}\r\n\r\n\tset g(_c: number) {\r\n\t\tthis._g = this.abs_val(_c);\r\n\t}\r\n\r\n\tget g() {\r\n\t\treturn this._g;\r\n\t}\r\n\r\n\tset b(_c: number) {\r\n\t\tthis._b = this.abs_val(_c);\r\n\t}\r\n\r\n\tget b() {\r\n\t\treturn this._b;\r\n\t}\r\n\tset a(_c: number) {\r\n\t\tthis._a = this.abs_val(_c);\r\n\t}\r\n\r\n\tget a() {\r\n\t\treturn this._a;\r\n\t}\r\n\r\n\tprivate abs_val(v: number) {\r\n\t\treturn v < 0 ? (v >= -1 ? -v : 0) : v > 255 ? (v % 255) / 255 : v / 255;\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tset color(c: _Color) {\r\n\t\tthis.r = c[0];\r\n\t\tthis.g = c[1];\r\n\t\tthis.b = c[2];\r\n\t\tthis.a = c[3] || -this.a;\r\n\t}\r\n\r\n\tgetColor() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tget buffer() {\r\n\t\treturn this._buffer;\r\n\t}\r\n}","import { Renderable } from './Renderable'\r\nimport { Color, _Color } from './Color'\r\nimport { Base } from './Base'\r\n\r\nexport class Rectangle extends Renderable {\r\n\tcolor: Color;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tx: number,\r\n\t\ty: number,\r\n\t\tw: number,\r\n\t\th: number,\r\n\t\tc: _Color = [1, 1, 1, 1]\r\n\t) {\r\n\t\tsuper(base, x, y, w, h);\r\n\t\tthis.program = base.defaultShapeProgram;\r\n\r\n\t\tthis.color = new Color(c);\r\n\t\tthis.attribs[\"aPosition\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs[\"aPosition\"]);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mWorld\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"mWorld\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mProj\"] = this.gl.getUniformLocation(this.program, \"mProj\");\r\n\t}\r\n}\r\n","import { Renderable } from './Renderable'\r\nimport { _Color } from './Color'\r\nimport { Base } from './Base'\r\n\r\nexport class Sprite extends Renderable {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\ttexture: WebGLTexture;\r\n\ttextureCoords: WebGLBuffer;\r\n\r\n\tconstructor(base: Base, img: ImageData, x: number, y: number) {\r\n\t\tsuper(base, x, y, img.width, img.height);\r\n\t\tthis.program = base.defaultSpriteProgram;\r\n\r\n\t\tthis.texture = this.gl.createTexture();\r\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_S,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_T,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MIN_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MAG_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texImage2D(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\t0,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.UNSIGNED_BYTE,\r\n\t\t\timg\r\n\t\t);\r\n\r\n\t\tthis.textureCoords = this.gl.createBuffer();\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.textureCoords);\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([0, 0, 0, 1, 1, 0, 1, 1]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\r\n\t\tthis.attribs[\"position\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.attribs[\"textureCoords\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aTextureCoords\"\r\n\t\t);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mWorld\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"mWorld\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mProj\"] = this.gl.getUniformLocation(this.program, \"mProj\");\r\n\t\tthis.uniforms[\"sampler\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"sampler\"\r\n\t\t);\r\n\t}\r\n}\r\n","// import * as glMatrix from \"gl-matrix\";\r\nimport { dvs, dfs, dsvs, dsfs } from './Programs'\r\nimport { Container } from './Container'\r\nimport { Instance, instance } from './Instance'\r\nimport { Renderable } from './Renderable'\r\nimport { Rectangle } from './Rectangle'\r\nimport { Sprite } from './Sprite'\r\nimport { Color, _Color } from './Color'\r\n\r\n// Zmienić punkt obrotu (pivot) na punkt transformacji (trans? transformationPoint?)\r\n\r\n// We flashu obiekty rysowane (sprite'y, kształty) nie mogą mieć dzieci (chyba)\r\n\r\n// TODO: Timeline ???\r\n\r\nexport interface vec2 {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport class Base {\r\n\tcanvas: HTMLCanvasElement;\r\n\tgl: WebGLRenderingContext;\r\n\r\n\tscene: Container;\r\n\tsceneInstance: Instance;\r\n\tbackgroundColor: Color;\r\n\r\n\tdefaultShapeProgram: WebGLProgram;\r\n\tdefaultSpriteProgram: WebGLProgram;\r\n\tdefaultIndicesBuffer: WebGLBuffer;\r\n\tindices: Uint16Array;\r\n\r\n\tprojectionMatrix: Float32Array;\r\n\r\n\tobjectsToDraw: Array<any | instance>;\r\n\tsymbols: Array<Container | Renderable | Rectangle | Sprite>;\r\n\trenderQueue: Array<Instance>;\r\n\r\n\tconstructor(\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t\tcanvas_id: string,\r\n\t\tbgC: _Color | Color = [-1, -1, -1, -1],\r\n\t\twebgl2: boolean = false\r\n\t) {\r\n\t\tthis.canvas = <HTMLCanvasElement>document.getElementById(canvas_id);\r\n\t\tif (this.canvas.nodeName != \"CANVAS\") {\r\n\t\t\tthis.canvas = document.createElement(\"canvas\");\r\n\t\t\tdocument.getElementById(canvas_id).appendChild(this.canvas);\r\n\t\t}\r\n\r\n\t\tthis.gl = <WebGLRenderingContext>(\r\n\t\t\tthis.canvas.getContext(webgl2 ? \"webgl2\" : \"webgl\")\r\n\t\t);\r\n\r\n\t\tif (!this.gl) {\r\n\t\t\tconsole.error(`Brak wsparcia dla ${webgl2 ? \"webgl2\" : \"webgl\"}.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.projectionMatrix = new Float32Array(9);\r\n\t\tthis.setCanvasSize(width, height);\r\n\r\n\t\tif (bgC instanceof Color) {\r\n\t\t\tthis.backgroundColor = bgC;\r\n\t\t} else {\r\n\t\t\tthis.backgroundColor = new Color(bgC);\r\n\t\t}\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.gl.enable(this.gl.CULL_FACE);\r\n\t\tthis.gl.enable(this.gl.BLEND);\r\n\t\tthis.gl.cullFace(this.gl.BACK);\r\n\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t\tthis.objectsToDraw = [];\r\n\t\tthis.symbols = [];\r\n\t\tthis.renderQueue = [];\r\n\t\tthis.scene = new Container(this, 0, 0, 1, 1);\r\n\t\t// this.sceneInstance = new Instance(this.scene);\r\n\r\n\t\tthis.defaultIndicesBuffer = this.gl.createBuffer();\r\n\t\tthis.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.defaultIndicesBuffer);\r\n\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ELEMENT_ARRAY_BUFFER,\r\n\t\t\tnew Uint16Array([0, 1, 2, 2, 1, 3]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\r\n\t\tthis.defaultShapeProgram = this.newProgram();\r\n\t\tthis.defaultSpriteProgram = this.newProgram(dsvs, dsfs);\r\n\t\t// this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, this.indices, this.gl.STATIC_DRAW);\r\n\t}\r\n\r\n\toldDraw() {\r\n\t\tthis.clear();\r\n\t\tthis.scene.updateWorldMatrix();\r\n\t\tlet lastProgram = null;\r\n\t\tlet child;\r\n\t\tfor (let i = 0; i < this.objectsToDraw.length; ++i) {\r\n\t\t\tchild = this.objectsToDraw[i];\r\n\t\t\tif (child.program !== lastProgram) {\r\n\t\t\t\tlastProgram = child.program;\r\n\t\t\t\tthis.gl.useProgram(lastProgram);\r\n\t\t\t}\r\n\r\n\t\t\tif (child.color) {\r\n\t\t\t\tthis.gl.uniform4fv(child.uniforms.uColor, child.color.buffer);\r\n\t\t\t} else if (child.texture) {\r\n\t\t\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, child.textureCoords);\r\n\t\t\t\tthis.gl.vertexAttribPointer(\r\n\t\t\t\t\tchild.attribs.textureCoords,\r\n\t\t\t\t\t2,\r\n\t\t\t\t\tthis.gl.FLOAT,\r\n\t\t\t\t\tfalse,\r\n\t\t\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\t\t\t\tthis.gl.enableVertexAttribArray(child.attribs.textureCoords);\r\n\r\n\t\t\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\r\n\t\t\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, child.texture);\r\n\t\t\t\tthis.gl.uniform1i(child.uniforms.sampler, 0);\r\n\t\t\t}\r\n\t\t\tthis.gl.bindBuffer(child.gl.ARRAY_BUFFER, child.shapeBuffer);\r\n\t\t\tthis.gl.vertexAttribPointer(\r\n\t\t\t\tchild.attribs.position,\r\n\t\t\t\t2,\r\n\t\t\t\tthis.gl.FLOAT,\r\n\t\t\t\tfalse,\r\n\t\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tthis.gl.enableVertexAttribArray(child.attribs.position);\r\n\t\t\tthis.gl.uniformMatrix3fv(\r\n\t\t\t\tchild.uniforms.mProj,\r\n\t\t\t\tfalse,\r\n\t\t\t\tthis.projectionMatrix\r\n\t\t\t);\r\n\t\t\tthis.gl.uniformMatrix3fv(child.uniforms.mWorld, false, child.worldMatrix);\r\n\t\t\tthis.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\r\n\t\t}\r\n\t}\r\n\r\n\tdraw() {\r\n\t\tthis.clear();\r\n\t\t// this.scene.updateWorldMatrix();\r\n\t\tthis.sceneInstance.updateWorldMatrix();\r\n\t\tlet lastProgram = null;\r\n\r\n\t\tfor (let item of this.renderQueue){\r\n\t\t\t// if (!item.isChild){\r\n\t\t\t// \titem.updateWorldMatrix();\r\n\t\t\t// }\r\n\t\t\tif (!item.visible || !item.source.program){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (lastProgram !== item.source.program){\r\n\t\t\t\tlastProgram = item.source.program;\r\n\t\t\t\tthis.gl.useProgram(lastProgram);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (item.source.color){\r\n\t\t\t\tthis.gl.uniform4fv(item.source.uniforms.uColor, item.source.color.buffer);\r\n\t\t\t}else if (item.source.texture){\r\n\t\t\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, item.source.textureCoords);\r\n\t\t\t\tthis.gl.vertexAttribPointer(\r\n\t\t\t\t\titem.source.attribs.textureCoords,\r\n\t\t\t\t\t2,\r\n\t\t\t\t\tthis.gl.FLOAT,\r\n\t\t\t\t\tfalse,\r\n\t\t\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\t\t\t\tthis.gl.enableVertexAttribArray(item.source.attribs.textureCoords);\r\n\t\t\t\tthis.gl.activeTexture(0);\r\n\t\t\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, item.source.texture);\r\n\t\t\t\tthis.gl.uniform1i(item.source.uniforms.sampler, 0);\r\n\t\t\t}\r\n\t\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, item.source.shapeBuffer);\r\n\t\t\tthis.gl.vertexAttribPointer(\r\n\t\t\t\titem.source.attribs.position,\r\n\t\t\t\t2,\r\n\t\t\t\tthis.gl.FLOAT,\r\n\t\t\t\tfalse,\r\n\t\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t\t0\r\n\t\t\t);\r\n\t\t\tthis.gl.enableVertexAttribArray(item.source.attribs.position);\r\n\t\t\tthis.gl.uniformMatrix3fv(\r\n\t\t\t\titem.source.uniforms.mProj,\r\n\t\t\t\tfalse,\r\n\t\t\t\tthis.projectionMatrix\r\n\t\t\t);\r\n\t\t\tthis.gl.uniformMatrix3fv(\r\n\t\t\t\titem.source.uniforms.mWorld,\r\n\t\t\t\tfalse,\r\n\t\t\t\titem.worldMatrix\r\n\t\t\t);\r\n\t\t\tthis.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\r\n\t\t}\r\n\t}\r\n\r\n\tcreateSceneInstance(){\r\n\t\tthis.sceneInstance = new Instance(this.scene);\r\n\t}\r\n\r\n\tsetCanvasSize(width, height) {\r\n\t\tthis.canvas.width = width;\r\n\t\tthis.canvas.height = height;\r\n\t\tthis.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n\t\tglMatrix.mat3.projection(this.projectionMatrix, width, height);\r\n\t}\r\n\r\n\tcompileShader(src: string, type: string) {\r\n\t\tlet t: number;\r\n\t\tif (type == \"vs\") {\r\n\t\t\tt = this.gl.VERTEX_SHADER;\r\n\t\t} else if (type == \"fs\") {\r\n\t\t\tt = this.gl.FRAGMENT_SHADER;\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Podano nie prawidłowy typ shader'a\");\r\n\t\t}\r\n\r\n\t\tlet s: WebGLShader = this.gl.createShader(t);\r\n\r\n\t\tthis.gl.shaderSource(s, src);\r\n\t\tthis.gl.compileShader(s);\r\n\r\n\t\tif (!this.gl.getShaderParameter(s, this.gl.COMPILE_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getShaderInfoLog(s));\r\n\t\t}\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\tcompileProgram(vs: WebGLShader, fs: WebGLShader) {\r\n\t\tlet p: WebGLProgram = this.gl.createProgram();\r\n\t\tthis.gl.attachShader(p, vs);\r\n\t\tthis.gl.attachShader(p, fs);\r\n\t\tthis.gl.linkProgram(p);\r\n\r\n\t\tif (!this.gl.getProgramParameter(p, this.gl.LINK_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getProgramInfoLog(p));\r\n\t\t}\r\n\r\n\t\treturn p;\r\n\t}\r\n\r\n\tnewVertexShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"vs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewFragmentShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"fs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewProgram(vs: string = dvs, fs: string = dfs) {\r\n\t\ttry {\r\n\t\t\treturn this.compileProgram(\r\n\t\t\t\tthis.newVertexShader(vs),\r\n\t\t\t\tthis.newFragmentShader(fs)\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.gl.clearColor(\r\n\t\t\tthis.backgroundColor.r,\r\n\t\t\tthis.backgroundColor.g,\r\n\t\t\tthis.backgroundColor.b,\r\n\t\t\tthis.backgroundColor.a\r\n\t\t);\r\n\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n\t}\r\n}\r\n"],"names":[],"mappings":"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"}