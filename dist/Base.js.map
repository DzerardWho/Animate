{"version":3,"file":"Base.js","sources":["../src/Matrix.ts","../src/EasingFunctions.ts","../src/Timeline.ts","../src/Programs.ts","../src/Renderable.ts","../src/Color.ts","../src/Rectangle.ts","../src/Sprite.ts","../src/Renderer.ts","../src/Base.ts"],"sourcesContent":["import { vec2 } from './Base'\r\n\r\nexport type Matrix = Array<number> | Float32Array;\r\n\r\nconst degToRad = Math.PI / 180;\r\n\r\nexport function computeMatrix(_in: Matrix, out: Matrix, pos: vec2, scale: vec2, trans: vec2, angle: number): Matrix {\r\n    let [a, b, , d, e, , g, h] = _in;\r\n    let x = pos.x,\r\n        y = pos.y,\r\n        px = trans.x,\r\n        py = trans.y,\r\n        sx = scale.x,\r\n        sy = scale.y;\r\n    angle *= degToRad;\r\n    let s = Math.sin(angle),\r\n        c = Math.cos(angle);\r\n\r\n    out[0] = sx * (c * a + s * d);\r\n    out[1] = sx * (c * b + s * e);\r\n    out[3] = sy * (c * d - s * a);\r\n    out[4] = sy * (c * e - s * b);\r\n    out[6] = a * (px * (1 - sx * c) + py * sy * s + x) + d * (py * (1 - sy * c) - px * sx * s + y) + g;\r\n    out[7] = b * (px * (1 - sx * c) + py * sy * s + x) + e * (py * (1 - sy * c) - px * sx * s + y) + h;\r\n    out[2] = out[5] = 0;\r\n    out[8] = 1;\r\n\r\n    return out;\r\n}\r\n\r\nexport function projectionMatrix(out: Matrix, width: number, height: number): Matrix {\r\n    out[0] = 2 / width;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[4] = -2 / height;\r\n    out[5] = 0;\r\n    out[6] = -1;\r\n    out[7] = 1;\r\n    out[8] = 1;\r\n    return out;\r\n}\r\n\r\nexport function createProjection(width: number, height: number): Matrix {\r\n    return new Float32Array([\r\n        2 / width,\r\n        0,\r\n        0,\r\n        0,\r\n        -2 / height,\r\n        0,\r\n        -1,\r\n        1,\r\n        1\r\n    ]);\r\n}","export function Linear(a: number) {\r\n    return a;\r\n}\r\n\r\nexport function easeInQuad(a: number) {\r\n    return a ** 2;\r\n}\r\n\r\nexport function easeOutQuad(a: number) {\r\n    return -a * (a - 2);\r\n}\r\n\r\nexport function easeInOutQuad(a: number) {\r\n    if (a < 0.5) {\r\n        return 2 * a ** 2;\r\n    } else {\r\n        a = a * 2 - 1;\r\n        return -0.5 * (a * (a - 2) - 1);\r\n    }\r\n}\r\n\r\nexport function easeInCubic(a: number) {\r\n    return a ** 3;\r\n}\r\n\r\nexport function easeOutCubic(a: number) {\r\n    return (a - 1) ** 3 + 1;\r\n}\r\n\r\nexport function easeInOutCubic(a: number) {\r\n    a *= 2;\r\n    if (a < 1) {\r\n        return 0.5 * a ** 3;\r\n    } else {\r\n        return 0.5 * ((a - 2) ** 3 + 2);\r\n    }\r\n}\r\n\r\nexport function easeInExpo(a: number) {\r\n    if (a === 0) {\r\n        return 0;\r\n    }\r\n    return 2 ** (10 * (a - 1));\r\n}\r\n\r\nexport function easeOutExpo(a: number) {\r\n    if (a === 1) {\r\n        return 1;\r\n    }\r\n    return -(2 ** (-10 * a)) + 1;\r\n}\r\n\r\nexport function easeInOutExpo(a: number) {\r\n    if (a === 0) {\r\n        return 0;\r\n    } else if (a === 1) {\r\n        return 1;\r\n    } else {\r\n        a *= 2;\r\n        if (a < 1) {\r\n            return 0.5 * 2 ** (10 * (a - 1));\r\n        } else {\r\n            a -= 1;\r\n            return 0.5 * (-1 * (2 ** (-10 * a)) + 2);\r\n        }\r\n    }\r\n}","import { vec2 } from './Base'\r\nimport { Linear } from './EasingFunctions'\r\nimport { computeMatrix, Matrix } from './Matrix'\r\nimport { Rectangle } from './Rectangle';\r\nimport { Sprite } from './Sprite';\r\n\r\ntype timeElement = Timeline | Sprite | Rectangle;\r\n\r\ninterface _Data {\r\n    pos?: vec2;\r\n    angle?: number;\r\n    scale?: vec2;\r\n    transformationPoint?: vec2;\r\n    alpha?: number;\r\n}\r\n\r\nexport class Data {\r\n    pos: vec2;\r\n    angle: number;\r\n    scale: vec2;\r\n    transformationPoint: vec2;\r\n    alpha: number;\r\n    dirty: boolean;\r\n\r\n    constructor(data: _Data | null) {\r\n        if (!data) {\r\n            return this;\r\n        }\r\n        this.pos = { x: 0, y: 0 };\r\n        if (data.pos) {\r\n            if (data.pos.x) {\r\n                this.pos.x = data.pos.x;\r\n            }\r\n            if (data.pos.y) {\r\n                this.pos.y = data.pos.y;\r\n            }\r\n        }\r\n\r\n        this.angle = data.angle || 0;\r\n        this.scale = { x: 1, y: 1 };\r\n        this.transformationPoint = { x: 0, y: 0 };\r\n        if (data.scale) {\r\n            if (data.scale.x) {\r\n                this.scale.x = data.scale.x;\r\n            }\r\n            if (data.scale.y) {\r\n                this.scale.y = data.scale.y;\r\n            }\r\n        }\r\n        if (data.transformationPoint) {\r\n            if (data.transformationPoint.x) {\r\n                this.transformationPoint.x = data.transformationPoint.x;\r\n            }\r\n            if (data.scale.y) {\r\n                this.transformationPoint.y = data.transformationPoint.y;\r\n            }\r\n        }\r\n        this.alpha = 1;\r\n    }\r\n\r\n    getData(to: Data, progress: number) {\r\n        let alpha = this.alpha + (to.alpha - this.alpha) * progress;\r\n        if (alpha < 0) {\r\n            alpha = 0;\r\n        } else if (alpha > 1) {\r\n            alpha = 1\r\n        }\r\n        return {\r\n            pos: {\r\n                x: this.pos.x + (to.pos.x - this.pos.x) * progress,\r\n                y: this.pos.y + (to.pos.y - this.pos.y) * progress\r\n            },\r\n            angle: this.angle + (to.angle - this.angle) * progress,\r\n            scale: {\r\n                x: this.scale.x + (to.scale.x - this.scale.x) * progress,\r\n                y: this.scale.y + (to.scale.y - this.scale.y) * progress,\r\n            },\r\n            transformationPoint: {\r\n                x: this.transformationPoint.x + (to.transformationPoint.x - this.transformationPoint.x) * progress,\r\n                y: this.transformationPoint.y + (to.transformationPoint.y - this.transformationPoint.y) * progress,\r\n            },\r\n            alpha: alpha\r\n        }\r\n    }\r\n}\r\n\r\nexport class Element {\r\n    object: timeElement;\r\n    motion: boolean;\r\n    continueFrom: number;\r\n    from: Data;\r\n    to: Data | null;\r\n    val: Data | null;\r\n    transMatrix: Float32Array;\r\n    easing: ((arg0: number) => number);\r\n\r\n    constructor(obj: timeElement, from: _Data, to?: _Data | null, continueFromFrame: number = 0) {\r\n        this.motion = to ? true : false;\r\n        this.easing = this.motion ? Linear : null;\r\n        this.to = this.motion ? new Data(to) : null;\r\n        // this.val = this.motion ? new Data(null) : null;\r\n        this.from = new Data(from);\r\n        this.object = obj;\r\n\r\n        this.transMatrix = new Float32Array(9);\r\n\r\n        this.continueFrom = continueFromFrame || 0;\r\n    }\r\n\r\n    draw(parentMatrix: Matrix, frame: number, duration: number) {\r\n        let progress;\r\n        frame += this.continueFrom;\r\n        if (frame > duration) {\r\n            if (this.object.loop) {\r\n                frame %= duration;\r\n            } else {\r\n                frame = duration;\r\n            }\r\n        }\r\n        progress = frame / duration;\r\n        let data = this.motion ? this.from.getData(this.to, this.easing(progress)) : this.from;\r\n        computeMatrix(parentMatrix, this.transMatrix, data.pos, data.scale, data.transformationPoint, data.angle);\r\n        this.object.draw(this.transMatrix, frame);\r\n    }\r\n}\r\n\r\nexport class Timeframe {\r\n    start: number;\r\n    duration: number;\r\n    elements: Array<Element>;\r\n\r\n    constructor(start: number, duration: number) {\r\n        this.start = start;\r\n        this.duration = duration;\r\n        this.elements = [];\r\n    }\r\n\r\n    in(frame: number) {\r\n        return (this.start >= frame && frame <= this.start + this.duration);\r\n    }\r\n\r\n    split(splitPoint: number) {\r\n        let t = splitPoint - this.start;\r\n        let s = new Timeframe(splitPoint, this.duration - t);\r\n        this.duration = t;\r\n        s.addElements(this.elements);\r\n    }\r\n\r\n    addElement(element: Element) {\r\n        this.elements.push(element);\r\n    }\r\n\r\n    addElements(elements: Array<Element>) {\r\n        for (let i of elements) {\r\n            this.addElement(i);\r\n        }\r\n    }\r\n}\r\n\r\nexport class TimeframeLayer {\r\n    frames: Array<Timeframe>;\r\n    duration: number;\r\n\r\n    constructor() {\r\n        this.frames = [];\r\n    }\r\n\r\n    addElement(obj: timeElement, from: _Data, to: _Data = null, start: number, duration: number, continueFrom: number = 0) {\r\n        // TODO \r\n        // Coś tu nie działa\r\n        let _dur = start + duration;\r\n        if (_dur > this.duration && start <= this.duration) {\r\n            _dur -= this.duration;\r\n            this.duration += _dur;\r\n        }\r\n\r\n        // let elem = new Element(obj, from, to, continueFrom);\r\n        //  this.solveCollisions( this.collision(start, duration), start, duration);\r\n        // let timeframe =  this.find(start, start + duration);\r\n        let timeFrame = this.find(start, duration);\r\n        if (timeFrame) {\r\n            timeFrame.addElement(new Element(obj, from, to, continueFrom))\r\n        } else {\r\n            let t = new Timeframe(start, duration);\r\n            t.addElement(new Element(obj, from, to, continueFrom));\r\n            let index = this.findIndex(start, duration);\r\n            if (index === -1) {\r\n                this.frames.push(t);\r\n            } else {\r\n                this.frames.splice(index + 1, 0, t);\r\n            }\r\n        }\r\n\r\n        return _dur;\r\n    }\r\n\r\n    //  solveCollisions(collisions: Array<Timeframe>, start: number, duration: number){\r\n\r\n    // }\r\n\r\n    collision(start: number, duration: number) {\r\n        return this.frames.filter((val) => {\r\n            if (start === val.start && duration === val.duration) {\r\n                return false;\r\n            }\r\n            if (start >= val.start && val.start <= start + duration) {\r\n                return true;\r\n            }\r\n            if (val.start >= start && start <= val.start + val.duration) {\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n\r\n    findByFrame(frame: number) {\r\n        return this.frames.find((val) => {\r\n            return (val.start <= frame && frame < val.start + val.duration);\r\n        });\r\n    }\r\n\r\n    find(start: number, duration: number) {\r\n        return this.frames.find((val) => {\r\n            return (val.start === start && val.duration === duration)\r\n        });\r\n    }\r\n\r\n    findIndex(start: number, duration: number) {\r\n        return this.frames.findIndex((val) => {\r\n            return (val.start < start)\r\n        });\r\n    }\r\n}\r\n\r\nexport class Timeline {\r\n    loop: boolean;\r\n    layers: Array<TimeframeLayer>;\r\n    duration: number;\r\n\r\n    constructor(loop: boolean = false) {\r\n        this.loop = loop;\r\n        this.layers = [];\r\n        this.duration = 0;\r\n    }\r\n\r\n    addLayer() {\r\n        this.layers.push(new TimeframeLayer);\r\n    }\r\n\r\n    addLayers(count: number) {\r\n        for (let i = 0; i < count; ++i) {\r\n            this.addLayer();\r\n        }\r\n    }\r\n\r\n    addToLayer(obj: timeElement, from: _Data, to: _Data, start: number, duration: number, layer: number, continueFrom: number = 0) {\r\n        if (layer > this.layers.length - 1) {\r\n            throw \"Layer out of range\";\r\n        }\r\n\r\n        this.duration += this.layers[layer].addElement(obj, from, to, start, duration, continueFrom);\r\n        return this;\r\n    }\r\n\r\n    draw(matrix: Matrix, frame: number) {\r\n        let timeFrame: Timeframe | null, _frame;\r\n        this.layers.forEach((layer) => {\r\n            if (this.loop) {\r\n                frame %= this.duration;\r\n            }\r\n            timeFrame = layer.findByFrame(frame);\r\n            if (!timeFrame) {\r\n                return;\r\n            }\r\n            _frame = frame - timeFrame.start;\r\n            // if (this.loop){\r\n            //     _frame %= this.duration;\r\n            // }\r\n            // console.log(this, _frame);\r\n            timeFrame.elements.forEach((element) => {\r\n                element.draw(matrix, _frame, timeFrame.duration);\r\n            });\r\n        });\r\n    }\r\n}","export const dvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\n\r\nuniform mat3 transMatrix;\r\n\r\nvoid main(){\r\n    gl_Position = vec4((transMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dfs = `precision mediump float;\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    gl_FragColor = uColor;\r\n}`;\r\n\r\nexport const dsvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\nattribute vec2 aTextureCoords;\r\n\r\nuniform mat3 transMatrix;\r\n\r\nvarying vec2 f_texCoord;\r\n\r\nvoid main(){\r\n\tf_texCoord = aTextureCoords;\r\n    gl_Position = vec4((transMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dsfs = `precision mediump float;\r\n\r\nvarying vec2 f_texCoord;\r\nuniform sampler2D sampler;\r\n\r\nvoid main(){\r\n\tgl_FragColor = texture2D(sampler, f_texCoord);\r\n}`;\r\n","import { vec2, Base } from './Base'\r\n\r\nexport class Renderable {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\tshapeBuffer: WebGLBuffer;\r\n\tprogram: WebGLProgram;\r\n\tgl: WebGLRenderingContext;\r\n\tbase: Base;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tw: number,\r\n\t\th: number\r\n\t) {\r\n\t\tthis.base = base;\r\n\t\tthis.gl = base.gl;\r\n\r\n\t\tthis.shapeBuffer = this.gl.createBuffer();\r\n\t\tthis.attribs = {};\r\n\t\tthis.uniforms = {};\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([\r\n\t\t\t\t0, 0,\r\n\t\t\t\t0, h,\r\n\t\t\t\tw, 0,\r\n\t\t\t\tw, h\r\n\t\t\t]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\t}\r\n}\r\n","export interface _Color {\r\n\t[0]: number;\r\n\t[1]: number;\r\n\t[2]: number;\r\n\t[3]?: number;\r\n}\r\n\r\nexport class Color {\r\n\tprivate _r: number;\r\n\tprivate _g: number;\r\n\tprivate _b: number;\r\n\tprivate _a: number;\r\n\tprivate _buffer: Float32Array;\r\n\r\n\tconstructor(r?: number | _Color, g?: number, b?: number, a?: number) {\r\n\t\tif (typeof r == \"object\") {\r\n\t\t\tthis._r = r[0] ? this.abs_val(r[0]) : 1;\r\n\t\t\tthis._g = r[1] ? this.abs_val(r[1]) : 1;\r\n\t\t\tthis._b = r[2] ? this.abs_val(r[2]) : 1;\r\n\t\t\tthis._a = r[3] ? this.abs_val(r[3]) : 1;\r\n\t\t} else {\r\n\t\t\tthis._r = r ? this.abs_val(r) : 1;\r\n\t\t\tthis._g = g ? this.abs_val(g) : 1;\r\n\t\t\tthis._b = b ? this.abs_val(b) : 1;\r\n\t\t\tthis._a = a ? this.abs_val(a) : 1;\r\n\t\t}\r\n\t\tthis._buffer = new Float32Array(this.getColor());\r\n\t}\r\n\r\n\tset r(_c: number) {\r\n\t\tthis._r = this.abs_val(_c);\r\n\t}\r\n\r\n\tget r() {\r\n\t\treturn this._r;\r\n\t}\r\n\r\n\tset g(_c: number) {\r\n\t\tthis._g = this.abs_val(_c);\r\n\t}\r\n\r\n\tget g() {\r\n\t\treturn this._g;\r\n\t}\r\n\r\n\tset b(_c: number) {\r\n\t\tthis._b = this.abs_val(_c);\r\n\t}\r\n\r\n\tget b() {\r\n\t\treturn this._b;\r\n\t}\r\n\tset a(_c: number) {\r\n\t\tthis._a = this.abs_val(_c);\r\n\t}\r\n\r\n\tget a() {\r\n\t\treturn this._a;\r\n\t}\r\n\r\n\tprivate abs_val(v: number) {\r\n\t\treturn v < 0 ? (v >= -1 ? -v : 0) : v > 255 ? (v % 255) / 255 : v / 255;\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tset color(c: _Color) {\r\n\t\tthis.r = c[0];\r\n\t\tthis.g = c[1];\r\n\t\tthis.b = c[2];\r\n\t\tthis.a = c[3] || -this.a;\r\n\t}\r\n\r\n\tgetColor() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tget buffer() {\r\n\t\treturn this._buffer;\r\n\t}\r\n}","import { Renderable } from './Renderable'\r\nimport { Color, _Color } from './Color'\r\nimport { Base } from './Base'\r\nimport { Matrix } from './Matrix'\r\n\r\nexport class Rectangle extends Renderable {\r\n\tcolor: Color;\r\n\tloop: boolean;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tw: number,\r\n\t\th: number,\r\n\t\tc: _Color = [1, 1, 1, 1]\r\n\t) {\r\n\t\tsuper(base, w, h);\r\n\t\tthis.loop = true;\r\n\t\tthis.program = base.defaultShapeProgram;\r\n\r\n\t\tthis.color = new Color(c);\r\n\t\tthis.attribs[\"position\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs[\"position\"]);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"transMatrix\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"transMatrix\"\r\n\t\t);\r\n\t}\r\n\r\n\tdraw(matrix: Matrix, frame: number) {\r\n\t\tif (this.base.lastUsedProgram !== this.program) {\r\n\t\t\tthis.base.lastUsedProgram = this.program;\r\n\t\t\tthis.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs['position'],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.uniform4fv(this.uniforms['uColor'], this.color.buffer);\r\n\t\tthis.gl.uniformMatrix3fv(this.uniforms['transMatrix'], false, matrix);\r\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t\t// this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t}\r\n}\r\n","import { Renderable } from './Renderable'\r\nimport { _Color } from './Color'\r\nimport { Base } from './Base'\r\nimport { Matrix } from './Matrix'\r\n\r\nexport class Sprite extends Renderable {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\ttexture: WebGLTexture;\r\n\ttextureCoords: WebGLBuffer;\r\n\tloop: boolean;\r\n\r\n\tconstructor(base: Base, img: ImageData) {\r\n\t\tsuper(base, img.width, img.height);\r\n\t\tthis.loop = true;\r\n\t\tthis.program = base.defaultSpriteProgram;\r\n\r\n\t\tthis.texture = this.gl.createTexture();\r\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_S,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_T,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MIN_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MAG_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texImage2D(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\t0,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.UNSIGNED_BYTE,\r\n\t\t\timg\r\n\t\t);\r\n\r\n\t\tthis.textureCoords = this.gl.createBuffer();\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.textureCoords);\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([0, 0, 0, 1, 1, 0, 1, 1]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\r\n\t\tthis.attribs[\"position\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.attribs[\"textureCoords\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aTextureCoords\"\r\n\t\t);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"transMatrix\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"transMatrix\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mProj\"] = this.gl.getUniformLocation(this.program, \"mProj\");\r\n\t\tthis.uniforms[\"sampler\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"sampler\"\r\n\t\t);\r\n\t}\r\n\r\n\tdraw(matrix: Matrix) {\r\n\t\tif (this.base.lastUsedProgram !== this.program) {\r\n\t\t\tthis.base.lastUsedProgram = this.program;\r\n\t\t\tthis.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.textureCoords);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs[\"textureCoords\"],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs[\"textureCoords\"]);\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs['position'],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\r\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\r\n\t\tthis.gl.uniform1i(this.uniforms['sampler'], 0);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs['position']);\r\n\t\tthis.gl.uniformMatrix3fv(this.uniforms['transMatrix'], false, matrix);\r\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t}\r\n}\r\n","import { Timeline } from './Timeline'\r\nimport { Matrix, createProjection } from './Matrix'\r\nimport { Base } from './Base'\r\nimport { Color } from './Color'\r\n\r\nexport class Renderer {\r\n    gl: WebGLRenderingContext;\r\n    isPlaying: boolean;\r\n    timing: number;\r\n    timeToNextUpdate: number;\r\n    lastUpdate: number;\r\n    mainTimeline: Timeline;\r\n    updateInterval: number;\r\n    frame: number;\r\n    projectionMatrix: Matrix;\r\n    backgroundColor: Color;\r\n    frameUpdated: boolean;\r\n\r\n    constructor(base: Base, fps: number, width: number, height: number, bgColor: Color) {\r\n        if (fps <= 0) {\r\n            throw \"Fps must be a positive number\";\r\n        }\r\n\r\n        this.gl = base.gl;\r\n        this.timing = 1000 / fps;\r\n        this.timeToNextUpdate = this.timing;\r\n        this.lastUpdate = 0;\r\n        this.frame = 0;\r\n        this.mainTimeline = null;\r\n        this.isPlaying = false;\r\n        this.projectionMatrix = createProjection(width, height);\r\n        this.backgroundColor = bgColor;\r\n        this.render = this.render.bind(this);\r\n        this.update = this.update.bind(this);\r\n    }\r\n\r\n    play() {\r\n        if (!this.isPlaying) {\r\n            this.isPlaying = true;\r\n            this.render();\r\n            setTimeout(() => {\r\n                this.update();\r\n                this.updateInterval = setInterval(this.update, this.timing);\r\n            }, this.timeToNextUpdate);\r\n        }\r\n    }\r\n\r\n    // private __play(){\r\n    //     if (!this.isPlaying){\r\n    //         // this.isPlaying = true;\r\n    //         this.updateInterval = setInterval(this.update, this.timing);\r\n    //         this.render();\r\n    //     }    \r\n    // }\r\n\r\n    pause() {\r\n        if (this.isPlaying) {\r\n            clearInterval(this.updateInterval);\r\n            this.timeToNextUpdate -= performance.now() - this.lastUpdate;\r\n            this.isPlaying = false;\r\n        }\r\n    }\r\n\r\n    update() {\r\n        if (this.isPlaying) {\r\n            ++this.frame;\r\n            this.frameUpdated = true;\r\n            requestAnimationFrame(this.render);\r\n            // requestAnimationFrame(() => {\r\n            //     this.render();\r\n            // });\r\n            this.lastUpdate = performance.now();\r\n            this.timeToNextUpdate = this.timing;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!this.mainTimeline) {\r\n            throw \"There is nothing to render (mainTimeline isn't set)\";\r\n        }\r\n        if (!(this.frameUpdated && this.isPlaying)) {\r\n            return;\r\n        }\r\n        this.frameUpdated = false;\r\n        this.clear();\r\n        this.mainTimeline.draw(this.projectionMatrix, this.frame);\r\n        if (!this.mainTimeline.loop && this.frame >= this.mainTimeline.duration){\r\n            this.pause();\r\n            return;\r\n        }\r\n        requestAnimationFrame(this.render);\r\n    }\r\n\r\n    clear() {\r\n        this.gl.clearColor(\r\n            this.backgroundColor.r,\r\n            this.backgroundColor.g,\r\n            this.backgroundColor.b,\r\n            this.backgroundColor.a\r\n        );\r\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n    }\r\n}","import { dvs, dfs, dsvs, dsfs } from './Programs'\r\nimport { Color, _Color } from './Color'\r\n// import { projectionMatrix, Matrix } from './Matrix'\r\nimport { Renderer } from './Renderer'\r\n// import { WebGLDebugUtils } from './../webgl-debug'\r\nimport { Timeline } from './Timeline';\r\n\r\n// Rysować do canvasu tylko wtedy, gdy bedzie 'frame' się zwiększy\r\nexport interface vec2 {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nfunction logGLCall(functionName, args) {\r\n\tconsole.log(\"gl.\" + functionName + \"(\" +\r\n\t\tWebGLDebugUtils.glFunctionArgsToString(functionName, args) + \")\");\r\n}\r\n\r\nfunction validateNoneOfTheArgsAreUndefined(functionName, args) {\r\n\tfor (var ii = 0; ii < args.length; ++ii) {\r\n\t\tif (args[ii] === undefined) {\r\n\t\t\tconsole.error(\"undefined passed to gl.\" + functionName + \"(\" +\r\n\t\t\t\tWebGLDebugUtils.glFunctionArgsToString(functionName, args) + \")\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction logAndValidate(functionName, args) {\r\n\tlogGLCall(functionName, args);\r\n\tvalidateNoneOfTheArgsAreUndefined(functionName, args);\r\n}\r\n\r\nfunction throwOnGLError(err, funcName, args) {\r\n\tthrow WebGLDebugUtils.glEnumToString(err) + \" was caused by call to: \" + funcName;\r\n};\r\n\r\nexport class Base {\r\n\tcanvas: HTMLCanvasElement;\r\n\tgl: WebGLRenderingContext;\r\n\r\n\t// mainScene: Timeline;\r\n\trenderer: Renderer;\r\n\t// backgroundColor: Color;\r\n\r\n\tdefaultShapeProgram: WebGLProgram;\r\n\tdefaultSpriteProgram: WebGLProgram;\r\n\tdefaultIndicesBuffer: WebGLBuffer;\r\n\tindices: Uint16Array;\r\n\r\n\t// projectionMatrix: Matrix;\r\n\tlastUsedProgram: WebGLProgram;\r\n\t// frame: number;\r\n\r\n\tconstructor(\r\n\t\tdebug: boolean = false,\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t\tcanvas_id: string,\r\n\t\tfps: number = 25,\r\n\t\twebgl2: boolean = false,\r\n\t\tbgC: _Color | Color = [-1, -1, -1, -1]\r\n\t) {\r\n\t\tthis.canvas = <HTMLCanvasElement>document.getElementById(canvas_id);\r\n\t\tif (this.canvas.nodeName != \"CANVAS\") {\r\n\t\t\tthis.canvas = document.createElement(\"canvas\");\r\n\t\t\tdocument.getElementById(canvas_id).appendChild(this.canvas);\r\n\t\t}\r\n\r\n\t\tthis.gl = <WebGLRenderingContext>(\r\n\t\t\tthis.canvas.getContext(webgl2 ? \"webgl2\" : \"webgl\")\r\n\t\t);\r\n\r\n\t\tif (!this.gl) {\r\n\t\t\tconsole.error(`Brak wsparcia dla ${webgl2 ? \"webgl2\" : \"webgl\"}.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (debug) {\r\n\t\t\tthis.gl = WebGLDebugUtils.makeDebugContext(this.gl, throwOnGLError, logAndValidate);\r\n\t\t}\r\n\r\n\t\t// this.projectionMatrix = new Float32Array(9);\r\n\t\tthis.setCanvasSize(width, height);\r\n\t\tthis.lastUsedProgram = null;\r\n\r\n\t\t// if (bgC instanceof Color) {\r\n\t\t// \tthis.backgroundColor = bgC;\r\n\t\t// } else {\r\n\t\t// \tthis.backgroundColor = new Color(bgC);\r\n\t\t// }\r\n\r\n\t\tthis.renderer = new Renderer(this, fps, width, height, bgC instanceof Color ? bgC : new Color(bgC));\r\n\r\n\t\tthis.gl.frontFace(this.gl.CW);\r\n\t\tthis.gl.enable(this.gl.BLEND);\r\n\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t\tthis.defaultShapeProgram = this.newProgram();\r\n\t\tthis.defaultSpriteProgram = this.newProgram(dsvs, dsfs);\r\n\t}\r\n\r\n\t// play(){\r\n\t// \tif (typeof this.mainScene == undefined){\r\n\t// \t\treturn;\r\n\t// \t}\r\n\t// \tthis.clear();\r\n\t// \tthis.mainScene.draw(this.projectionMatrix, this.frame);\r\n\t// }\r\n\r\n\tsetCanvasSize(width, height) {\r\n\t\tthis.canvas.width = width;\r\n\t\tthis.canvas.height = height;\r\n\t\tthis.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n\t\t// projectionMatrix(this.projectionMatrix, width, height);\r\n\t}\r\n\r\n\tcompileShader(src: string, type: string) {\r\n\t\tlet t: number;\r\n\t\tif (type == \"vs\") {\r\n\t\t\tt = this.gl.VERTEX_SHADER;\r\n\t\t} else if (type == \"fs\") {\r\n\t\t\tt = this.gl.FRAGMENT_SHADER;\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Podano nie prawidłowy typ shader'a\");\r\n\t\t}\r\n\r\n\t\tlet s: WebGLShader = this.gl.createShader(t);\r\n\r\n\t\tthis.gl.shaderSource(s, src);\r\n\t\tthis.gl.compileShader(s);\r\n\r\n\t\tif (!this.gl.getShaderParameter(s, this.gl.COMPILE_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getShaderInfoLog(s));\r\n\t\t}\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\tcompileProgram(vs: WebGLShader, fs: WebGLShader) {\r\n\t\tlet p: WebGLProgram = this.gl.createProgram();\r\n\t\tthis.gl.attachShader(p, vs);\r\n\t\tthis.gl.attachShader(p, fs);\r\n\t\tthis.gl.linkProgram(p);\r\n\r\n\t\tif (!this.gl.getProgramParameter(p, this.gl.LINK_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getProgramInfoLog(p));\r\n\t\t}\r\n\r\n\t\treturn p;\r\n\t}\r\n\r\n\tnewVertexShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"vs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewFragmentShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"fs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewProgram(vs: string = dvs, fs: string = dfs) {\r\n\t\ttry {\r\n\t\t\treturn this.compileProgram(\r\n\t\t\t\tthis.newVertexShader(vs),\r\n\t\t\t\tthis.newFragmentShader(fs)\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tget mainTimeline(){\r\n\t\treturn this.renderer.mainTimeline;\r\n\t}\r\n\r\n\tset mainTimeline(value: Timeline){\r\n\t\tif (!(value instanceof Timeline)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.renderer.mainTimeline = value;\r\n\t}\r\n\r\n\tplay(){\r\n\t\tthis.renderer.play();\r\n\t}\r\n\r\n\tpause(){\r\n\t\tthis.renderer.pause();\r\n\t}\r\n\r\n\t// clear() {\r\n\t// \tthis.gl.clearColor(\r\n\t// \t\tthis.backgroundColor.r,\r\n\t// \t\tthis.backgroundColor.g,\r\n\t// \t\tthis.backgroundColor.b,\r\n\t// \t\tthis.backgroundColor.a\r\n\t// \t);\r\n\t// \tthis.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n\t// }\r\n}\r\n"],"names":[],"mappings":"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"}