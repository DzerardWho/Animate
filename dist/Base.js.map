{"version":3,"file":"Base.js","sources":["../src/Matrix.ts","../src/EasingFunctions.ts","../src/Timeline.ts","../src/Programs.ts","../src/Renderable.ts","../src/Color.ts","../src/Rectangle.ts","../src/Sprite.ts","../src/Base.ts"],"sourcesContent":["import { vec2 } from './Base'\r\n\r\nexport type Matrix = Array<number> | Float32Array;\r\n\r\nexport function computeMatrix(_in: Matrix, out: Matrix, pos: vec2, scale: vec2, trans: vec2, angle: number): Matrix {\r\n    let [a, b, , d, e, , g, h] = _in;\r\n    let x = pos.x,\r\n        y = pos.y,\r\n        px = trans.x,\r\n        py = trans.y,\r\n        sx = scale.x,\r\n        sy = scale.y;\r\n    let s = Math.sin(angle),\r\n        c = Math.cos(angle);\r\n\r\n    out[0] = sx * (c * a + s * d);\r\n    out[1] = sx * (c * b + s * e);\r\n    out[3] = sy * (c * d - s * a);\r\n    out[4] = sy * (c * e - s * b);\r\n    out[6] = a * (px * (1 - sx * c) + py * sy * s + x) + d * (py * (1 - sy * c) - px * sx * s + y) + g;\r\n    out[7] = b * (px * (1 - sx * c) + py * sy * s + x) + e * (py * (1 - sy * c) - px * sx * s + y) + h;\r\n    out[2] = out[5] = 0;\r\n    out[8] = 1;\r\n\r\n    return out;\r\n}\r\n\r\nexport function projectionMatrix(out: Matrix, width: number, height: number): Matrix {\r\n    out[0] = 2 / width;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[4] = -2 / height;\r\n    out[5] = 0;\r\n    out[6] = -1;\r\n    out[7] = 1;\r\n    out[8] = 1;\r\n    return out;\r\n}\r\n\r\nexport function createProjection(width: number, height: number): Matrix {\r\n    return new Float32Array([\r\n        2 / width,\r\n        0,\r\n        0,\r\n        0,\r\n        -2 / height,\r\n        0,\r\n        -1,\r\n        1,\r\n        1\r\n    ]);\r\n}","export function Linear(a: number){\r\n    return a;\r\n}\r\n\r\nexport function easeInQuad(a: number){\r\n    return a ** 2;\r\n}\r\n\r\nexport function easeOutQuad(a: number){\r\n    return -a * (a - 2);\r\n}\r\n\r\nexport function easeInOutQuad(a: number){\r\n    if (a < 0.5){\r\n        return 2 * a ** 2;\r\n    }else{\r\n        a = a * 2 - 1;\r\n        return -0.5 * (a * (a - 2) - 1);\r\n    }\r\n}\r\n\r\nexport function easeInCubic(a: number){\r\n    return a ** 3;\r\n}\r\n\r\nexport function easeOutCubic(a: number){\r\n    return (a - 1) ** 3 + 1;\r\n}\r\n\r\nexport function easeInOutCubic(a: number){\r\n    a *= 2;\r\n    if (a < 1){\r\n        return 0.5 * a ** 3;\r\n    }else{\r\n        return 0.5 * ((a - 2) ** 3 + 2);\r\n    }\r\n}\r\n\r\nexport function easeInExpo(a: number){\r\n    if (a === 0){\r\n        return 0;\r\n    }\r\n    return 2 ** (10 * (a - 1));\r\n}\r\n\r\nexport function easeOutExpo(a: number){\r\n    if (a === 1){\r\n        return 1;\r\n    }\r\n    return -(2 ** (-10 * a)) + 1;\r\n}\r\n\r\nexport function easeInOutExpo(a: number){\r\n    if (a === 0){\r\n        return 0;\r\n    }else if (a === 1){\r\n        return 1;\r\n    }else{\r\n        a *= 2;\r\n        if (a < 1){\r\n            return 0.5 * 2 ** (10 * (a - 1));\r\n        }else{\r\n            a -= 1;\r\n            return 0.5 * (-1 * (2 ** (-10 * a)) + 2);\r\n        }\r\n    }\r\n}","import { vec2 } from './Base'\r\nimport { Linear } from './EasingFunctions'\r\nimport { computeMatrix, Matrix } from './Matrix'\r\nimport { Rectangle } from './Rectangle';\r\nimport { Sprite } from './Sprite';\r\n\r\ntype timeElement = Timeline | Sprite | Rectangle;\r\n\r\ninterface _Data{\r\n    pos?: vec2;\r\n    angle?: number;\r\n    scale?: vec2;\r\n    transformationPoint?: vec2;\r\n    alpha?: number;\r\n}\r\n\r\nexport class Data {\r\n    pos: vec2;\r\n    angle: number;\r\n    scale: vec2;\r\n    transformationPoint: vec2;\r\n    alpha: number;\r\n    dirty: boolean;\r\n\r\n    constructor(data: _Data | null) {\r\n        if (!data){\r\n            return this;\r\n        }\r\n        this.pos = {x: data.pos.x, y: data.pos.y};\r\n\r\n        this.angle = data.angle;\r\n        this.scale = {x: 1, y: 1};\r\n        this.transformationPoint = {x: 0, y: 0};\r\n        if (data.scale){\r\n            if (data.scale.x){\r\n                this.scale.x = data.scale.x;\r\n            }\r\n            if (data.scale.y){\r\n                this.scale.y = data.scale.y;\r\n            }\r\n        }\r\n        if (data.transformationPoint){\r\n            if (data.transformationPoint.x){\r\n                this.transformationPoint.x = data.transformationPoint.x;\r\n            }\r\n            if (data.scale.y){\r\n                this.transformationPoint.y = data.transformationPoint.y;\r\n            }\r\n        }\r\n        this.alpha = 1;\r\n    }\r\n\r\n    // get x(){\r\n    //     return this._x;\r\n    // }\r\n\r\n    // set x(value: number){\r\n    //     if (this._x === value){\r\n    //         return;\r\n    //     }\r\n    //     this._x = value;\r\n    //     this.dirty = true;\r\n    // }\r\n    \r\n    // get y(){\r\n    //     return this._y;\r\n    // }\r\n\r\n    // set y(value: number){\r\n    //     if (this._y === value){\r\n    //         return;\r\n    //     }\r\n    //     this._y = value;\r\n    //     this.dirty = true;\r\n    // }\r\n    \r\n    // get angle(){\r\n    //     return this._angle;\r\n    // }\r\n\r\n    // set angle(value: number){\r\n    //     if (this._angle === value){\r\n    //         return;\r\n    //     }\r\n    //     this._angle = value;\r\n    //     this.dirty = true;\r\n    // }\r\n    \r\n    // get scale(){\r\n    //     return this._scale;\r\n    // }\r\n\r\n    // set scale(value: vec2){\r\n    //     if (this._scale === value){\r\n    //         return;\r\n    //     }\r\n    //     this._scale = value;\r\n    //     this.dirty = true;\r\n    // }\r\n    \r\n    // get transformationPoint(){\r\n    //     return this._transformationPoint;\r\n    // }\r\n    \r\n    // set transformationPoint(value: vec2){\r\n    //     if (this._transformationPoint === value){\r\n    //         return;\r\n    //     }\r\n    //     this._transformationPoint = value;\r\n    //     this.dirty = true;\r\n    // }\r\n    \r\n    // get alpha(){\r\n    //     return this._alpha;\r\n    // }\r\n    \r\n    // set alpha(value: number){\r\n    //     if (this._alpha === value){\r\n    //         return;\r\n    //     }\r\n    //     this._alpha = value;\r\n    //     this.dirty = true;\r\n    // }\r\n\r\n    async getData(to: Data, progress: number) {\r\n        let alpha = this.alpha + (to.alpha - this.alpha) * progress;\r\n        if (alpha < 0){\r\n            alpha = 0;\r\n        }else if(alpha > 1){\r\n            alpha = 1\r\n        }\r\n        return {\r\n            pos: {\r\n                x: this.pos.x + (to.pos.x - this.pos.x) * progress,\r\n                y: this.pos.y + (to.pos.y - this.pos.y) * progress\r\n            },\r\n            angle: this.angle + (to.angle - this.angle) * progress,\r\n            scale: {\r\n                x: this.scale.x + (to.scale.x - this.scale.x) * progress,\r\n                y: this.scale.y + (to.scale.y - this.scale.y) * progress,\r\n            },\r\n            transformationPoint: {\r\n                x: this.transformationPoint.x + (to.transformationPoint.x - this.transformationPoint.x) * progress,\r\n                y: this.transformationPoint.y + (to.transformationPoint.y - this.transformationPoint.y) * progress,\r\n            },\r\n            alpha: alpha\r\n        }\r\n    }\r\n}\r\n\r\nexport class Element {\r\n    object: timeElement;\r\n    motion: boolean;\r\n    continueFrom: number;\r\n    from: Data;\r\n    to: Data | null;\r\n    val: Data | null;\r\n    transMatrix: Float32Array;\r\n    easing: ((arg0: number) => number);\r\n\r\n    constructor(obj: timeElement, from: _Data, to?: _Data | null, continueFromFrame: number = 0){\r\n        this.motion = to ? true : false;\r\n        this.easing = this.motion ? Linear : null;\r\n        this.to = this.motion ? new Data(to) : null;\r\n        // this.val = this.motion ? new Data(null) : null;\r\n        this.from = new Data(from);\r\n        this.object = obj;\r\n\r\n        this.continueFrom = continueFromFrame || 0;\r\n    }\r\n    \r\n    async draw(parentMatrix: Matrix, frame: number, duration: number){\r\n        let progress;\r\n        frame += this.continueFrom;\r\n        if (frame > duration){\r\n            if (this.object.loop){\r\n                frame %= duration;\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n        progress = frame / duration;\r\n        let data = this.motion ? await this.from.getData(this.to, this.easing(progress)) : this.from;\r\n        computeMatrix(parentMatrix, this.transMatrix, data.pos, data.scale, data.transformationPoint, data.angle);\r\n        this.object.draw(this.transMatrix, frame);\r\n    }\r\n}\r\n\r\nexport class Timeframe {\r\n    start: number;\r\n    duration: number;\r\n    elements: Array<Element>;\r\n\r\n    constructor(start: number, duration: number) {\r\n        this.start = start;\r\n        this.duration = duration;\r\n        this.elements = [];\r\n    }\r\n\r\n    in(frame: number){\r\n        return (this.start >= frame && frame <= this.start + this.duration);\r\n    }\r\n\r\n    split(splitPoint: number){\r\n        let t = splitPoint - this.start;\r\n        let s = new Timeframe(splitPoint, this.duration - t);\r\n        this.duration = t;\r\n        s.addElements(this.elements);\r\n    }\r\n\r\n    addElement(element: Element){\r\n        this.elements.push(element);\r\n    }\r\n\r\n    addElements(elements: Array<Element>){\r\n        for (let i of elements){\r\n            this.addElement(i);\r\n        }\r\n    }\r\n}\r\n\r\nexport class TimeframeLayer {\r\n    frames: Array<Timeframe>;\r\n    duration: number;\r\n\r\n    constructor(){\r\n        this.frames = [];\r\n    }\r\n\r\n    async addElement(obj: timeElement, from: _Data, to: _Data = null, start: number, duration: number, continueFrom: number = 0){\r\n        let _dur = start + duration;\r\n        if (_dur > this.duration && start <= this.duration){\r\n            _dur -= this.duration;\r\n            this.duration += _dur;\r\n        }\r\n\r\n        // let elem = new Element(obj, from, to, continueFrom);\r\n        // await this.solveCollisions(await this.collision(start, duration), start, duration);\r\n        // let timeframe = await this.find(start, start + duration);\r\n        let timeFrame = await this.find(start, duration);\r\n        if (timeFrame){\r\n            timeFrame.addElement(new Element(obj, from, to, continueFrom))\r\n        } else {\r\n            let t = new Timeframe(start, duration);\r\n            t.addElement(new Element(obj, from, to, continueFrom));\r\n            let index = await this.findIndex(start, duration);\r\n            if (index === -1){\r\n                this.frames.push(t);\r\n            }else{\r\n                this.frames.splice(index + 1, 0, t);\r\n            }\r\n        }\r\n\r\n        return _dur;\r\n    }\r\n\r\n    // async solveCollisions(collisions: Array<Timeframe>, start: number, duration: number){\r\n\r\n    // }\r\n\r\n    async collision(start: number, duration: number){\r\n        return this.frames.filter((val) => {\r\n            if (start === val.start && duration === val.duration){\r\n                return false;\r\n            }\r\n            if (start >= val.start && val.start <= start + duration){\r\n                return true;\r\n            }\r\n            if (val.start >= start && start <= val.start + val.duration){\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    }\r\n\r\n    async findByFrame(frame: number) {\r\n        return this.frames.find((val) => {\r\n            return (val.start >= frame && frame <= val.start + val.duration);\r\n        });\r\n    }\r\n\r\n    async find(start: number, duration: number) {\r\n        return this.frames.find((val) => {\r\n            return (val.start === start && val.duration === duration)\r\n        });\r\n    }\r\n    \r\n    findIndex(start: number, duration: number) {\r\n        return this.frames.findIndex((val) => {\r\n            return (val.start < start)\r\n        });\r\n    }\r\n}\r\n\r\nexport class Timeline {\r\n    loop: boolean;\r\n    layers: Array<TimeframeLayer>;\r\n    duration: number;\r\n\r\n    constructor(){\r\n        this.loop = false;\r\n        this.layers = [];\r\n        this.duration = 0;\r\n    }\r\n\r\n    addLayer(){\r\n        this.layers.push(new TimeframeLayer);\r\n    }\r\n\r\n    addLayers(count: number){\r\n        for(let i = 0; i < count; ++i){\r\n            this.addLayer();\r\n        }\r\n    }\r\n\r\n    async addToLayer(obj: timeElement, from: _Data, to: _Data, start: number, duration: number, layer: number, continueFrom: number = 0){\r\n        if (layer > this.layers.length - 1){\r\n            throw \"Layer out of range\";\r\n        }\r\n\r\n        this.duration += await this.layers[layer].addElement(obj, from, to, start, duration, continueFrom);\r\n        return this;\r\n    }\r\n\r\n    async draw(matrix: Matrix, frame: number){\r\n        let timeFrame, _frame;\r\n        this.layers.forEach(async (layer) => {\r\n            timeFrame = await layer.findByFrame(frame);\r\n            if (!timeFrame){\r\n                return;\r\n            }\r\n            _frame = frame - timeFrame.start;\r\n            timeFrame.elements.forEach(async (element) => {\r\n                await element.draw(matrix, _frame);\r\n            });\r\n        });\r\n    }\r\n}","export const dvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\n\r\nuniform mat3 transMatrix;\r\n\r\nvoid main(){\r\n    gl_Position = vec4((transMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dfs = `precision mediump float;\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    gl_FragColor = uColor;\r\n}`;\r\n\r\nexport const dsvs = `precision mediump float;\r\n\r\nattribute vec2 aPosition;\r\nattribute vec2 aTextureCoords;\r\n\r\nuniform mat3 transMatrix;\r\n\r\nvarying vec2 f_texCoord;\r\n\r\nvoid main(){\r\n\tf_texCoord = aTextureCoords;\r\n    gl_Position = vec4((transMatrix * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r\n}`;\r\n\r\nexport const dsfs = `precision mediump float;\r\n\r\nvarying vec2 f_texCoord;\r\nuniform sampler2D sampler;\r\n\r\nvoid main(){\r\n\tgl_FragColor = texture2D(sampler, f_texCoord);\r\n}`;\r\n","import { vec2, Base } from './Base'\r\n\r\nexport class Renderable {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\tshapeBuffer: WebGLBuffer;\r\n\tprogram: WebGLProgram;\r\n\tgl: WebGLRenderingContext;\r\n\tbase: Base;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tw: number,\r\n\t\th: number\r\n\t) {\r\n\t\tthis.base = base;\r\n\t\tthis.gl = base.gl;\r\n\r\n\t\tthis.shapeBuffer = this.gl.createBuffer();\r\n\t\tthis.attribs = {};\r\n\t\tthis.uniforms = {};\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([\r\n\t\t\t\t0, 0,\r\n\t\t\t\t0, h,\r\n\t\t\t\tw, 0,\r\n\t\t\t\tw, h\r\n\t\t\t]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\t}\r\n}\r\n","export interface _Color {\r\n\t[0]: number;\r\n\t[1]: number;\r\n\t[2]: number;\r\n\t[3]?: number;\r\n}\r\n\r\nexport class Color {\r\n\tprivate _r: number;\r\n\tprivate _g: number;\r\n\tprivate _b: number;\r\n\tprivate _a: number;\r\n\tprivate _buffer: Float32Array;\r\n\r\n\tconstructor(r?: number | _Color, g?: number, b?: number, a?: number) {\r\n\t\tif (typeof r == \"object\") {\r\n\t\t\tthis._r = r[0] ? this.abs_val(r[0]) : 1;\r\n\t\t\tthis._g = r[1] ? this.abs_val(r[1]) : 1;\r\n\t\t\tthis._b = r[2] ? this.abs_val(r[2]) : 1;\r\n\t\t\tthis._a = r[3] ? this.abs_val(r[3]) : 1;\r\n\t\t} else {\r\n\t\t\tthis._r = r ? this.abs_val(r) : 1;\r\n\t\t\tthis._g = g ? this.abs_val(g) : 1;\r\n\t\t\tthis._b = b ? this.abs_val(b) : 1;\r\n\t\t\tthis._a = a ? this.abs_val(a) : 1;\r\n\t\t}\r\n\t\tthis._buffer = new Float32Array(this.getColor());\r\n\t}\r\n\r\n\tset r(_c: number) {\r\n\t\tthis._r = this.abs_val(_c);\r\n\t}\r\n\r\n\tget r() {\r\n\t\treturn this._r;\r\n\t}\r\n\r\n\tset g(_c: number) {\r\n\t\tthis._g = this.abs_val(_c);\r\n\t}\r\n\r\n\tget g() {\r\n\t\treturn this._g;\r\n\t}\r\n\r\n\tset b(_c: number) {\r\n\t\tthis._b = this.abs_val(_c);\r\n\t}\r\n\r\n\tget b() {\r\n\t\treturn this._b;\r\n\t}\r\n\tset a(_c: number) {\r\n\t\tthis._a = this.abs_val(_c);\r\n\t}\r\n\r\n\tget a() {\r\n\t\treturn this._a;\r\n\t}\r\n\r\n\tprivate abs_val(v: number) {\r\n\t\treturn v < 0 ? (v >= -1 ? -v : 0) : v > 255 ? (v % 255) / 255 : v / 255;\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tset color(c: _Color) {\r\n\t\tthis.r = c[0];\r\n\t\tthis.g = c[1];\r\n\t\tthis.b = c[2];\r\n\t\tthis.a = c[3] || -this.a;\r\n\t}\r\n\r\n\tgetColor() {\r\n\t\treturn [this._r, this._g, this._b, this._a];\r\n\t}\r\n\r\n\tget buffer() {\r\n\t\treturn this._buffer;\r\n\t}\r\n}","import { Renderable } from './Renderable'\r\nimport { Color, _Color } from './Color'\r\nimport { Base } from './Base'\r\nimport { Matrix } from './Matrix'\r\n\r\nexport class Rectangle extends Renderable {\r\n\tcolor: Color;\r\n\tloop: boolean;\r\n\r\n\tconstructor(\r\n\t\tbase: Base,\r\n\t\tw: number,\r\n\t\th: number,\r\n\t\tc: _Color = [1, 1, 1, 1]\r\n\t) {\r\n\t\tsuper(base, w, h);\r\n\t\tthis.loop = true;\r\n\t\tthis.program = base.defaultShapeProgram;\r\n\r\n\t\tthis.color = new Color(c);\r\n\t\tthis.attribs[\"aPosition\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs[\"aPosition\"]);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"transMatrix\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"transMatrix\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mProj\"] = this.gl.getUniformLocation(this.program, \"mProj\");\r\n\t}\r\n\r\n\tasync draw(matrix: Matrix, frame: number){\r\n\t\tif (this.base.lastUsedProgram !== this.program){\r\n\t\t\tthis.base.lastUsedProgram = this.program;\r\n\t\t\tthis.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tthis.gl.uniform4fv(this.attribs['uColor'], this.color.buffer);\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs['position'],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs['position']);\r\n\t\tthis.gl.uniformMatrix3fv(this.attribs['transMatrix'], false, matrix);\r\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t}\r\n}\r\n","import { Renderable } from './Renderable'\r\nimport { _Color } from './Color'\r\nimport { Base } from './Base'\r\nimport { Matrix } from './Matrix'\r\n\r\nexport class Sprite extends Renderable {\r\n\tattribs: Object;\r\n\tuniforms: Object;\r\n\r\n\ttexture: WebGLTexture;\r\n\ttextureCoords: WebGLBuffer;\r\n\tloop: boolean;\r\n\r\n\tconstructor(base: Base, img: ImageData) {\r\n\t\tsuper(base, img.width, img.height);\r\n\t\tthis.loop = true;\r\n\t\tthis.program = base.defaultSpriteProgram;\r\n\r\n\t\tthis.texture = this.gl.createTexture();\r\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_S,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_WRAP_T,\r\n\t\t\tthis.gl.CLAMP_TO_EDGE\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MIN_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texParameteri(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\tthis.gl.TEXTURE_MAG_FILTER,\r\n\t\t\tthis.gl.LINEAR\r\n\t\t);\r\n\t\tthis.gl.texImage2D(\r\n\t\t\tthis.gl.TEXTURE_2D,\r\n\t\t\t0,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.RGBA,\r\n\t\t\tthis.gl.UNSIGNED_BYTE,\r\n\t\t\timg\r\n\t\t);\r\n\r\n\t\tthis.textureCoords = this.gl.createBuffer();\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.textureCoords);\r\n\t\tthis.gl.bufferData(\r\n\t\t\tthis.gl.ARRAY_BUFFER,\r\n\t\t\tnew Float32Array([0, 0, 0, 1, 1, 0, 1, 1]),\r\n\t\t\tthis.gl.STATIC_DRAW\r\n\t\t);\r\n\r\n\t\tthis.attribs[\"position\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aPosition\"\r\n\t\t);\r\n\t\tthis.attribs[\"textureCoords\"] = this.gl.getAttribLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"aTextureCoords\"\r\n\t\t);\r\n\t\tthis.uniforms[\"uColor\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"uColor\"\r\n\t\t);\r\n\t\tthis.uniforms[\"transMatrix\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"transMatrix\"\r\n\t\t);\r\n\t\tthis.uniforms[\"mProj\"] = this.gl.getUniformLocation(this.program, \"mProj\");\r\n\t\tthis.uniforms[\"sampler\"] = this.gl.getUniformLocation(\r\n\t\t\tthis.program,\r\n\t\t\t\"sampler\"\r\n\t\t);\r\n\t}\r\n\r\n\tasync draw(matrix: Matrix){\r\n\t\tif (this.base.lastUsedProgram !== this.program){\r\n\t\t\tthis.base.lastUsedProgram = this.program;\r\n\t\t\tthis.gl.useProgram(this.program);\r\n\t\t}\r\n\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.textureCoords);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs[\"textureCoords\"],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs[\"textureCoords\"]);\r\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.shapeBuffer);\r\n\t\tthis.gl.vertexAttribPointer(\r\n\t\t\tthis.attribs['position'],\r\n\t\t\t2,\r\n\t\t\tthis.gl.FLOAT,\r\n\t\t\tfalse,\r\n\t\t\t2 * Float32Array.BYTES_PER_ELEMENT,\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.gl.enableVertexAttribArray(this.attribs['position']);\r\n\t\tthis.gl.uniformMatrix3fv(this.attribs['transMatrix'], false, matrix);\r\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\r\n\t}\r\n}\r\n","import { dvs, dfs, dsvs, dsfs } from './Programs'\r\nimport { Renderable } from './Renderable'\r\nimport { Rectangle } from './Rectangle'\r\nimport { Sprite } from './Sprite'\r\nimport { Color, _Color } from './Color'\r\nimport { Timeline } from './Timeline'\r\nimport { createProjection, projectionMatrix, Matrix } from './Matrix'\r\n\r\n// TODO: Timeline ???\r\n// Rysować do canvasu tylko wtedy, gdy bedzie 'frame' się zwiększy\r\nexport interface vec2 {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nexport class Base {\r\n\tcanvas: HTMLCanvasElement;\r\n\tgl: WebGLRenderingContext;\r\n\r\n\tmainScene: Timeline;\r\n\tbackgroundColor: Color;\r\n\r\n\tdefaultShapeProgram: WebGLProgram;\r\n\tdefaultSpriteProgram: WebGLProgram;\r\n\tdefaultIndicesBuffer: WebGLBuffer;\r\n\tindices: Uint16Array;\r\n\r\n\tprojectionMatrix: Matrix;\r\n\tlastUsedProgram: WebGLProgram;\r\n\r\n\tconstructor(\r\n\t\twidth: number,\r\n\t\theight: number,\r\n\t\tcanvas_id: string,\r\n\t\tbgC: _Color | Color = [-1, -1, -1, -1],\r\n\t\twebgl2: boolean = false,\r\n\t\tfps: number = 25\r\n\t) {\r\n\t\tthis.canvas = <HTMLCanvasElement>document.getElementById(canvas_id);\r\n\t\tif (this.canvas.nodeName != \"CANVAS\") {\r\n\t\t\tthis.canvas = document.createElement(\"canvas\");\r\n\t\t\tdocument.getElementById(canvas_id).appendChild(this.canvas);\r\n\t\t}\r\n\r\n\t\tthis.gl = <WebGLRenderingContext>(\r\n\t\t\tthis.canvas.getContext(webgl2 ? \"webgl2\" : \"webgl\")\r\n\t\t);\r\n\r\n\t\tif (!this.gl) {\r\n\t\t\tconsole.error(`Brak wsparcia dla ${webgl2 ? \"webgl2\" : \"webgl\"}.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.projectionMatrix = new Float32Array(9);\r\n\t\tthis.setCanvasSize(width, height);\r\n\t\tthis.lastUsedProgram = null;\r\n\t\tthis.mainScene = null;\r\n\r\n\t\tif (bgC instanceof Color) {\r\n\t\t\tthis.backgroundColor = bgC;\r\n\t\t} else {\r\n\t\t\tthis.backgroundColor = new Color(bgC);\r\n\t\t}\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.gl.enable(this.gl.CULL_FACE);\r\n\t\tthis.gl.enable(this.gl.BLEND);\r\n\t\tthis.gl.cullFace(this.gl.BACK);\r\n\t\tthis.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n\t\tthis.defaultShapeProgram = this.newProgram();\r\n\t\tthis.defaultSpriteProgram = this.newProgram(dsvs, dsfs);\r\n\t}\r\n\r\n\tplay(){\r\n\t\tif (typeof this.mainScene == undefined){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.mainScene.draw(this.projectionMatrix, 0);\r\n\t}\r\n\r\n\tsetCanvasSize(width, height) {\r\n\t\tthis.canvas.width = width;\r\n\t\tthis.canvas.height = height;\r\n\t\tthis.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n\t\tprojectionMatrix(this.projectionMatrix, width, height);\r\n\t}\r\n\r\n\tcompileShader(src: string, type: string) {\r\n\t\tlet t: number;\r\n\t\tif (type == \"vs\") {\r\n\t\t\tt = this.gl.VERTEX_SHADER;\r\n\t\t} else if (type == \"fs\") {\r\n\t\t\tt = this.gl.FRAGMENT_SHADER;\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Podano nie prawidłowy typ shader'a\");\r\n\t\t}\r\n\r\n\t\tlet s: WebGLShader = this.gl.createShader(t);\r\n\r\n\t\tthis.gl.shaderSource(s, src);\r\n\t\tthis.gl.compileShader(s);\r\n\r\n\t\tif (!this.gl.getShaderParameter(s, this.gl.COMPILE_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getShaderInfoLog(s));\r\n\t\t}\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\tcompileProgram(vs: WebGLShader, fs: WebGLShader) {\r\n\t\tlet p: WebGLProgram = this.gl.createProgram();\r\n\t\tthis.gl.attachShader(p, vs);\r\n\t\tthis.gl.attachShader(p, fs);\r\n\t\tthis.gl.linkProgram(p);\r\n\r\n\t\tif (!this.gl.getProgramParameter(p, this.gl.LINK_STATUS)) {\r\n\t\t\tthrow new Error(this.gl.getProgramInfoLog(p));\r\n\t\t}\r\n\r\n\t\treturn p;\r\n\t}\r\n\r\n\tnewVertexShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"vs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewFragmentShader(src: string) {\r\n\t\ttry {\r\n\t\t\treturn this.compileShader(src, \"fs\");\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tnewProgram(vs: string = dvs, fs: string = dfs) {\r\n\t\ttry {\r\n\t\t\treturn this.compileProgram(\r\n\t\t\t\tthis.newVertexShader(vs),\r\n\t\t\t\tthis.newFragmentShader(fs)\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.gl.clearColor(\r\n\t\t\tthis.backgroundColor.r,\r\n\t\t\tthis.backgroundColor.g,\r\n\t\t\tthis.backgroundColor.b,\r\n\t\t\tthis.backgroundColor.a\r\n\t\t);\r\n\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\r\n\t}\r\n}\r\n"],"names":[],"mappings":"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"}